<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒé«”è¿½è¹¤èˆ‡è»Œè·¡è¨˜éŒ„ (Tracking + Chart.js)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tracking.js/1.1.3/tracking-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h2 { margin-bottom: 10px; }
        
        /* ç‰ˆé¢é…ç½®ï¼šå·¦å³å…©æ¬„ */
        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* è¦–è¨Šå€å¡Š */
        .video-container {
            position: relative;
            width: 400px;
            height: 300px;
            border: 3px solid #444;
            background: #000;
        }
        
        video, canvas.overlay {
            position: absolute;
            top: 0;
            left: 0;
            /* é¡åƒç¿»è½‰ï¼Œæ“ä½œæ¯”è¼ƒç›´è¦º */
            transform: scaleX(-1); 
        }

        /* åœ–è¡¨å€å¡Š */
        .chart-container {
            width: 400px;
            height: 300px;
            background-color: #2a2a2a;
            border: 3px solid #444;
            padding: 10px;
        }

        .status { margin-top: 15px; color: #0f0; font-family: monospace; }
    </style>
</head>
<body>

    <h2>ğŸ¾ å¯¦æ™‚è»Œè·¡è¨˜éŒ„ (é»ƒè‰²è¿½è¹¤)</h2>
    
    <div class="main-container">
        <div class="video-container">
            <video id="video" width="400" height="300" preload autoplay loop muted></video>
            <canvas id="canvas" class="overlay" width="400" height="300"></canvas>
        </div>

        <div class="chart-container">
            <canvas id="positionChart"></canvas>
        </div>
    </div>

    <div class="status" id="status">ç­‰å¾…å•Ÿå‹•...</div>

    <script>
        window.onload = function() {
            // --- 1. è¨­ç½®è®Šæ•¸ ---
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            const statusDiv = document.getElementById('status');
            
            // --- 2. åˆå§‹åŒ– Chart.js åœ–è¡¨ ---
            const ctxChart = document.getElementById('positionChart').getContext('2d');
            
            const positionChart = new Chart(ctxChart, {
                type: 'scatter', // æ•£ä½ˆåœ–æœ€é©åˆåš X,Y åº§æ¨™åœ–
                data: {
                    datasets: [{
                        label: 'çƒé«”è»Œè·¡ (æœ€è¿‘50é»)',
                        data: [], // é€™è£¡æœƒå‹•æ…‹å¡«å…¥ {x, y}
                        backgroundColor: 'rgba(255, 206, 86, 1)', // é»ƒè‰²é»
                        borderColor: 'rgba(255, 206, 86, 0.5)',
                        borderWidth: 1,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0 // é—œé–‰å‹•ç•«ä»¥æé«˜æ•ˆèƒ½
                    },
                    scales: {
                        x: {
                            min: 0,
                            max: 400, // å°æ‡‰ Video å¯¬åº¦
                            title: { display: true, text: 'X åº§æ¨™ (åƒç´ )' },
                            grid: { color: '#444' }
                        },
                        y: {
                            min: 0,
                            max: 300, // å°æ‡‰ Video é«˜åº¦
                            reverse: true, // é‡è¦ï¼è¢å¹•åº§æ¨™Yæ˜¯å‘ä¸‹å¢åŠ ï¼Œåœ–è¡¨é€šå¸¸å‘ä¸Šå¢åŠ ï¼Œæ‰€ä»¥åè½‰
                            title: { display: true, text: 'Y åº§æ¨™ (åƒç´ )' },
                            grid: { color: '#444' }
                        }
                    }
                }
            });

            // --- 3. åˆå§‹åŒ– Tracking.js ---
            const tracker = new tracking.ColorTracker(['yellow']);
            
            // èª¿æ•´éˆæ•åº¦
            tracker.setMinDimension(10);
            tracker.setMinGroupSize(10);

            tracking.track('#video', tracker, { camera: true });

            // --- 4. è™•ç†è¿½è¹¤äº‹ä»¶ ---
            tracker.on('track', function(event) {
                context.clearRect(0, 0, canvas.width, canvas.height);

                if (event.data.length === 0) {
                    statusDiv.innerHTML = "æœªåµæ¸¬åˆ°ç‰©é«”...";
                    statusDiv.style.color = "#888";
                } else {
                    // åªå–ç¬¬ä¸€å€‹åµæ¸¬åˆ°çš„ç‰©é«” (é¿å…å¤šé¡†çƒå¹²æ“¾åœ–è¡¨)
                    const rect = event.data[0];
                    
                    // è¨ˆç®—ä¸­å¿ƒé»
                    const centerX = rect.x + (rect.width / 2);
                    const centerY = rect.y + (rect.height / 2);

                    // 1. åœ¨ç•«é¢ä¸Šç•«æ¡†
                    context.strokeStyle = '#FF0000';
                    context.lineWidth = 2;
                    context.strokeRect(rect.x, rect.y, rect.width, rect.height);
                    context.fillStyle = '#fff';
                    context.fillText(`(${Math.round(centerX)}, ${Math.round(centerY)})`, rect.x, rect.y - 5);

                    // 2. æ›´æ–°åœ–è¡¨æ•¸æ“š
                    updateChart(centerX, centerY);

                    statusDiv.innerHTML = `åº§æ¨™ X: ${Math.round(centerX)}, Y: ${Math.round(centerY)}`;
                    statusDiv.style.color = "#0f0";
                }
            });

            // --- 5. åœ–è¡¨æ›´æ–°å‡½å¼ ---
            function updateChart(x, y) {
                const dataset = positionChart.data.datasets[0];
                
                // æ–°å¢æ•¸æ“šé» (å› ç‚º Video CSS æœ‰é¡åƒ scaleX(-1)ï¼Œé€™è£¡ X è»¸å¯èƒ½éœ€è¦æ ¹æ“šéœ€æ±‚åè½‰)
                // é€™è£¡æˆ‘å€‘ç›´æ¥è¨˜éŒ„åŸå§‹åµæ¸¬åˆ°çš„åº§æ¨™
                dataset.data.push({ x: x, y: y });

                // ä¿æŒé™£åˆ—é•·åº¦åœ¨ 50 å€‹ä»¥å…§ (åˆªé™¤æœ€èˆŠçš„)
                if (dataset.data.length > 50) {
                    dataset.data.shift();
                }

                // æ›´æ–°åœ–è¡¨
                positionChart.update();
            }
        };
    </script>
</body>
</html>
